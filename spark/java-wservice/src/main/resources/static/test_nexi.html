<!DOCTYPE html>
<html lang="en">
<head>
  <title>Nexi Hosted Fields Test</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.map"></script>

  <!-- Load the bundle from the server -->
  <script>
	  window.onload = () =>
    {
      console.log("[+] Calling the server for the JS bundle...");

		  let request = axios.get('/rest/nexi/pay/bundle');

      request.then((response) => {
          // Inject and init SDK
          document.getElementsByTagName("head")[0].innerHTML += response.data;
          initNexiSdk();
      })
      .catch((error) => console.error(error));
	  }

    let initNexiSdk = () =>
    {
        // Init XPay SDK
        XPay.init();

        console.log(XPay.Environments);
    }
  </script>
  <script>
	  function generaTimestamp()
          {
            document.getElementById("timestamp").value  = Date.now();
          }
          </script>

  <script> function sendReq()
           {
              axios.post('/rest/nexi/pay')
              .then(function (response)
              {
                console.log(JSON.parse(response));
                var cont = 0;
                document.getElementById("bod").innerHTML = "<h1>Response</h1><br/>";
                for (var key in p)
                {
                  cont++;
                  if (p.hasOwnProperty(key))
                  {
                    console.log(key + " -> " + p[key]);
                    document.getElementById("bod").innerHTML+="<b>" + key + ": </b>" + p[key] + "<br/>";
                  }
                }
              }).catch(
                function (error) {
                console.log("ERROR");
              });
           }
  </script>

</head>

<body id="bod">
<form class="jumbotron col-lg-7">
  <div class="row">
    <div class="form-group col-sm-4">
      <label for="exampleInputEmail1">Alias</label>
      <input type="text" class="form-control" id="alias" aria-describedby="" placeholder="Es: atmE">
    <!--<small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>-->
    </div>
  </div>
  <div class="row">
    <div class="form-group col-sm-4">
      <label for="exampleInputEmail1">Numero carta</label>
      <input type="text" class="form-control" id="numeroCarta" aria-describedby="" placeholder="Es: 40236074295829991">
    </div>
    <div class="form-group col-sm-2">
      <label for="exampleInputEmail1">Scadenza</label>
      <input type="text" class="form-control" id="scadenzaCarta" aria-describedby="" placeholder="Es: 12/18">
    </div>
    <div class="form-group col-sm-2">
      <label for="exampleInputEmail1">CVV</label>
      <input type="text" class="form-control" id="cvvCarta" aria-describedby="" placeholder="Es: 709">
    </div>
  </div>
  <div class="row">
    <div class="form-group col-sm-4">
      <label for="exampleInputPassword1">Timestamp</label>
      <input type="text" class="form-control" id="timestamp" placeholder="Timestamp">
      <button type="button" class="btn btn-dark" onclick="generaTimestamp();">Genera</button>
    </div>
  </div>
  <div class="row" id="ins">
    <div class="form-group col-sm-4">
      <label for="exampleInputPassword1">Codice transazione</label>
      <input type="text" class="form-control" id="codiceTransazione" placeholder="codice trans">
    </div>
    <div class="form-group col-sm-4">
      <label for="exampleInputPassword1">Importo transazione</label>
      <input type="text" class="form-control" id="importo" placeholder="$$$$$$$">
    </div>
  </div>
    <!--div class="form-check">
      <input type="checkbox" class="form-check-input" id="exampleCheck1">
      <label class="form-check-label" for="exampleCheck1">Check me out</label>
    </div-->
    <button class="btn btn-primary" onclick="sendReq();">Invia</button>
</form>
</body>
</html>
